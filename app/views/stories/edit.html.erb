<% key = Rails.application.config.session_options[:key] %>

<%= content_for :scripts do %>

<script type="text/javascript">
    var upload_params = {
			'<%= key %>' : '<%= cookies[key] %>',
			'<%= request_forgery_protection_token %>' : '<%= form_authenticity_token %>',
      '_http_accept': 'application/javascript'
    };
    var url = $('input#photo_image').attr('rel');
    $('input#photo_image').uploadify({
      'swf'            : '/assets/uploadify.swf',
      'uploader'       : url,
      'fileObjName'	   : 'photo[image]',
      'fileTypeExts'   : '*.png;*.jpg;*.gif',
      'cancelImg'			 : '/images/cancel.png',
      'multi'          : true,
      'formData'       : upload_params,
      'auto'           : true,
      'onUploadSuccess' : function(file, data, response) {
        $('#photos').append(data);
      }
    });
</script>

<% end %>

<div id="photos">
<%= render :partial => 'photos/photo', :collection => @story.photos %>
</div>

<% unless @story.new_record? %>
	<%= fields_for Photo.new do |f| %>
		<%= f.file_field :image, :rel => story_photos_path(@story) %>
	<% end %>
<% end %>
